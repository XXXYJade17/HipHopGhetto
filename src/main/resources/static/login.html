<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>HipHop Ghetto | 登录注册</title>
    <!-- 引入外部资源 -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@700;800&family=Montserrat:wght@400;500;600&display=swap');

        * {
            transition: all 0.3s ease;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: #0A0A0A;
            color: #CCCCCC;
            overflow-x: hidden;
        }

        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .card-bg {
            background: #1F1F1F;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .main-btn {
            background: linear-gradient(to right, #FFD700, #FFA500);
            border-radius: 8px;
            height: 48px;
            color: #0A0A0A;
            font-weight: 600;
            cursor: pointer;
            border: none;
            width: 100%;
            font-size: 16px;
        }

        .main-btn:hover {
            transform: scale(1.02);
        }

        .main-btn:active {
            transform: scale(0.98);
        }

        .outline-btn {
            border: 1px solid #FFD700;
            border-radius: 8px;
            color: #FFD700;
            padding: 8px 16px;
            text-decoration: none;
            display: inline-block;
        }

        .outline-btn:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .section-title {
            background: linear-gradient(to right, #FFD700, #FF8C00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .input-field {
            background: #333333;
            border: 1px solid #444444;
            border-radius: 8px;
            color: #FFFFFF;
            height: 48px;
            padding: 0 16px;
            width: 100%;
            font-size: 16px;
        }

        .input-field:focus {
            border-color: #FFD700;
            outline: none;
        }

        .input-error {
            border-color: #DC143C !important;
        }

        .error-message {
            color: #DC143C;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .tab-indicator {
            height: 2px;
            background: linear-gradient(to right, #FFD700, #FF8C00);
            width: 50%;
            transition: all 0.3s ease;
        }

        /* 提示信息样式 */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: #0A0A0A;
            font-weight: 600;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .toast.success {
            background: #FFD700;
        }
        .toast.error {
            background: #DC143C;
            color: #FFFFFF;
        }
        .toast.show {
            opacity: 1;
        }

        /* 表单标签样式 */
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }

        /* 表单组间距 */
        .form-group {
            margin-bottom: 16px;
        }

        /* 底部提示文字 */
        .form-footer {
            margin-top: 24px;
            font-size: 14px;
            color: #808080;
            text-align: center;
        }

        .form-footer a {
            color: #FFD700;
            text-decoration: none;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        /* 协议勾选区域 */
        .terms-group {
            margin-bottom: 24px;
            font-size: 14px;
            color: #808080;
            display: flex;
            align-items: flex-start;
        }

        .terms-group input {
            margin-right: 8px;
            margin-top: 2px;
        }

        .terms-group a {
            color: #FFD700;
            text-decoration: none;
        }

        .terms-group a:hover {
            text-decoration: underline;
        }

        /* 忘记密码链接 */
        .forgot-password {
            text-align: right;
            margin-top: 4px;
            font-size: 14px;
        }

        .forgot-password a {
            color: #FFD700;
            text-decoration: none;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        /* 适配移动端 */
        @media (max-width: 768px) {
            .container {
                padding: 0 20px;
            }

            .auth-container {
                flex-direction: column;
            }

            .auth-illustration {
                display: none;
            }

            .card-bg {
                padding: 20px;
                margin-top: 20px;
            }

            h3 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
<!-- 提示组件 -->
<div class="toast" id="toast"></div>

<!-- 顶部导航 -->
<header class="bg-black py-4 border-b border-[#1F1F1F]">
    <div class="container flex items-center justify-between">
        <!-- Logo -->
        <div class="flex items-center">
            <iconify-icon class="text-gold" height="38" icon="game-icons:boom-mic" width="40"></iconify-icon>
            <h1 class="text-white text-2xl font-bold ml-2 tracking-wider">HipHop Ghetto</h1>
        </div>
        <!-- 右侧链接 -->
        <div>
            <a href="#" class="text-[#CCCCCC] hover:text-[#FFD700] mr-6">首页</a>
            <a href="#" class="outline-btn px-4 py-2">了解更多</a>
        </div>
    </div>
</header>

<!-- 主内容区 -->
<main class="flex-1 flex items-center justify-center py-12">
    <div class="container">
        <div class="auth-container flex gap-8 items-center">
            <!-- 右侧表单 -->
            <div class="w-full lg:w-1/2 max-w-md mx-auto">
                <div class="card-bg p-8">
                    <!-- 标签切换 -->
                    <div class="mb-8">
                        <div class="flex relative">
                            <button id="login-tab" class="flex-1 py-2 text-center font-medium text-white">登录</button>
                            <button id="register-tab" class="flex-1 py-2 text-center font-medium text-[#808080]">注册</button>
                            <div class="tab-indicator absolute bottom-0 left-0"></div>
                        </div>
                    </div>

                    <!-- 登录表单 -->
                    <div id="login-form">
                        <h3 class="text-2xl font-bold text-white mb-6">欢迎回来</h3>
                        <p class="text-[#808080] mb-6">登录你的账号，继续探索嘻哈世界</p>

                        <form id="loginForm">
                            <div class="form-group">
                                <label for="login-account">用户名/手机号/邮箱</label>
                                <input class="input-field" id="login-account" name="account" placeholder="输入用户名、手机号或邮箱" type="text" required/>
                                <div class="error-message" id="login-account-error">请输入有效的用户名、手机号或邮箱</div>
                            </div>

                            <div class="form-group">
                                <label for="login-password">密码</label>
                                <input class="input-field" id="login-password" name="password" placeholder="输入密码" type="password" required/>
                                <div class="error-message" id="login-password-error">密码长度必须在8-32个字符之间，且包含字母和数字</div>
                                <div class="forgot-password">
                                    <a href="#">忘记密码?</a>
                                </div>
                            </div>

                            <button type="submit" class="main-btn mb-6">登录账号</button>

                            <div class="form-footer">
                                <span>还没有账号? <a href="javascript:;" id="switch-to-register">立即注册</a></span>
                            </div>
                        </form>
                    </div>

                    <!-- 注册表单：修改为手机号+邮箱双输入框（至少填一个） -->
                    <div id="register-form" class="hidden">
                        <h3 class="text-2xl font-bold text-white mb-6">创建账号</h3>
                        <p class="text-[#808080] mb-6">加入我们的社区，发现更多嘻哈音乐和文化</p>

                        <form id="registerForm">
                            <div class="form-group">
                                <label for="register-username">用户名</label>
                                <input class="input-field" id="register-username" name="username" placeholder="设置你的用户名" type="text" required/>
                                <div class="error-message" id="register-username-error">用户名长度必须为6-16位，只能包含中文、字母、数字和下划线</div>
                            </div>

                            <!-- 新增：手机号输入框 -->
                            <div class="form-group">
                                <label for="register-phone">手机号（选填）</label>
                                <input class="input-field" id="register-phone" name="phone" placeholder="输入手机号（可选）" type="tel"/>
                                <div class="error-message" id="register-phone-error">请输入有效的手机号</div>
                            </div>

                            <!-- 新增：邮箱输入框 -->
                            <div class="form-group">
                                <label for="register-email">邮箱（选填）</label>
                                <input class="input-field" id="register-email" name="email" placeholder="输入邮箱（可选）" type="email"/>
                                <div class="error-message" id="register-email-error">请输入有效的邮箱地址</div>
                            </div>

                            <div class="form-group">
                                <label for="register-password">密码</label>
                                <input class="input-field" id="register-password" name="password" placeholder="设置密码（至少8位，需包含字母、数字和特殊字符）" type="password" required/>
                                <div class="error-message" id="register-password-error">密码长度必须为8-20位，且包含字母、数字和特殊字符</div>
                            </div>

                            <div class="form-group">
                                <label for="register-confirm">确认密码</label>
                                <input class="input-field" id="register-confirm" name="confirmPassword" placeholder="再次输入密码" type="password" required/>
                                <div class="error-message" id="register-confirm-error">两次输入的密码不一致</div>
                            </div>

                            <div class="terms-group">
                                <input type="checkbox" id="agree-terms" required/>
                                <label for="agree-terms">
                                    我已阅读并同意<a href="#">用户协议</a>和<a href="#">隐私政策</a>
                                </label>
                            </div>

                            <button type="submit" class="main-btn mb-6">创建账号</button>

                            <div class="form-footer">
                                <span>已有账号? <a href="javascript:;" id="switch-to-login">立即登录</a></span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 底部区域 -->
<footer class="py-8 bg-[#0A0A0A] border-t border-[#1F1F1F]">
    <div class="container">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <iconify-icon class="text-gold" icon="game-icons:boom-mic" width="24"></iconify-icon>
                <h3 class="text-white text-lg font-bold ml-2">HipHop Ghetto</h3>
            </div>
            <div class="flex space-x-6 mb-4 md:mb-0">
                <a class="text-[#808080] hover:text-[#FFD700] text-sm" href="#">关于我们</a>
                <a class="text-[#808080] hover:text-[#FFD700] text-sm" href="#">用户协议</a>
                <a class="text-[#808080] hover:text-[#FFD700] text-sm" href="#">隐私政策</a>
                <a class="text-[#808080] hover:text-[#FFD700] text-sm" href="#">帮助中心</a>
            </div>
            <div class="text-sm text-[#808080]">
                © 2025 HipHop Ghetto. 保留所有权利
            </div>
        </div>
    </div>
</footer>

<script>
    // 1. 基础配置：后端接口基础路径
    const BASE_URL = "http://localhost:9998";

    // 2. 工具函数：显示提示信息
    function showToast(message, isSuccess = true) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${isSuccess ? 'success' : 'error'} show`;
        setTimeout(() => {
            toast.className = 'toast';
        }, 3000);
    }

    // 3. 验证工具函数
    const Validator = {
        // 验证用户名
        username: function(value) {
            const regex = /^[a-zA-Z0-9_\u4e00-\u9fa5]+$/;
            return value.length >= 6 && value.length <= 16 && regex.test(value);
        },
        // 验证手机号
        phone: function(value) {
            if (!value) return true; // 允许为空
            const regex = /^1[3-9]\d{9}$/;
            return regex.test(value);
        },
        // 验证邮箱
        email: function(value) {
            if (!value) return true; // 允许为空
            const regex = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            return regex.test(value);
        },
        // 验证密码（注册）
        passwordRegister: function(value) {
            const regex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+=-]).+$/;
            return value.length >= 8 && value.length <= 20 && regex.test(value);
        },
        // 验证密码（登录）
        passwordLogin: function(value) {
            const regex = /^(?=.*[A-Za-z])(?=.*\d).+$/;
            return value.length >= 8 && value.length <= 32 && regex.test(value);
        },
        // 验证账号（登录）
        account: function(value) {
            return value.trim().length > 0;
        }
    };

    // 4. 表单切换逻辑
    document.addEventListener('DOMContentLoaded', function() {
        const loginTab = document.getElementById('login-tab');
        const registerTab = document.getElementById('register-tab');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const tabIndicator = document.querySelector('.tab-indicator');
        const switchToRegister = document.getElementById('switch-to-register');
        const switchToLogin = document.getElementById('switch-to-login');
        const loginFormEl = document.getElementById('loginForm');
        const registerFormEl = document.getElementById('registerForm');

        // 切换到登录
        function showLoginForm() {
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            loginTab.classList.remove('text-[#808080]');
            loginTab.classList.add('text-white');
            registerTab.classList.remove('text-white');
            registerTab.classList.add('text-[#808080]');
            tabIndicator.style.transform = 'translateX(0)';
        }

        // 切换到注册
        function showRegisterForm() {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            registerTab.classList.remove('text-[#808080]');
            registerTab.classList.add('text-white');
            loginTab.classList.remove('text-white');
            loginTab.classList.add('text-[#808080]');
            tabIndicator.style.transform = 'translateX(100%)';
        }

        // 绑定切换事件
        loginTab.addEventListener('click', showLoginForm);
        registerTab.addEventListener('click', showRegisterForm);
        switchToRegister.addEventListener('click', showRegisterForm);
        switchToLogin.addEventListener('click', showLoginForm);

        // 5. 输入框焦点效果
        const inputs = document.querySelectorAll('.input-field');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.classList.add('scale-[1.02]');
                this.classList.remove('input-error');
                const errorElement = this.parentElement.querySelector('.error-message');
                if (errorElement) errorElement.classList.remove('show');
            });
            input.addEventListener('blur', function() {
                this.parentElement.classList.remove('scale-[1.02]');
                validateInput(this);
            });
        });

        // 6. 输入框验证
        function validateInput(input) {
            const id = input.id;
            const value = input.value.trim();
            let isValid = true;
            let errorMessage = '';

            if (id === 'register-username') {
                isValid = Validator.username(value);
                errorMessage = '用户名长度必须为6-16位，只能包含中文、字母、数字和下划线';
            } else if (id === 'register-phone') {
                isValid = Validator.phone(value);
                errorMessage = '请输入有效的手机号';
            } else if (id === 'register-email') {
                isValid = Validator.email(value);
                errorMessage = '请输入有效的邮箱地址';
            } else if (id === 'register-password') {
                isValid = Validator.passwordRegister(value);
                errorMessage = '密码长度必须为8-20位，且包含字母、数字和特殊字符';
            } else if (id === 'register-confirm') {
                const password = document.getElementById('register-password').value;
                isValid = value === password;
                errorMessage = '两次输入的密码不一致';
            } else if (id === 'login-account') {
                isValid = Validator.account(value);
                errorMessage = '请输入用户名、手机号或邮箱';
            } else if (id === 'login-password') {
                isValid = Validator.passwordLogin(value);
                errorMessage = '密码长度必须在8-32个字符之间，且包含字母和数字';
            }

            const errorElement = input.parentElement.querySelector('.error-message');
            if (!isValid && value) {
                input.classList.add('input-error');
                if (errorElement) {
                    errorElement.textContent = errorMessage;
                    errorElement.classList.add('show');
                }
            } else {
                input.classList.remove('input-error');
                if (errorElement) errorElement.classList.remove('show');
            }

            return isValid;
        }

        // 7. 登录表单提交逻辑
        loginFormEl.addEventListener('submit', async function(e) {
            e.preventDefault();

            // 前端验证
            const accountInput = document.getElementById('login-account');
            const passwordInput = document.getElementById('login-password');

            let isFormValid = true;

            if (!validateInput(accountInput)) isFormValid = false;
            if (!validateInput(passwordInput)) isFormValid = false;

            if (!isFormValid) {
                showToast('请检查输入的信息是否正确', false);
                return;
            }

            const formData = new FormData(this);
            const loginData = {
                account: formData.get('account'),
                password: formData.get('password')
            };

            try {
                const response = await axios({
                    url: `${BASE_URL}/user/login`,
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: loginData
                });

                const { code, message, data } = response.data;
                if (code === 200) {
                    showToast('登录成功！即将跳转到首页');
                    // 存储JWT令牌和用户信息
                    localStorage.setItem('authentication', data.token);
                    localStorage.setItem('userId', data.id);
                    localStorage.setItem('username', data.username || formData.get('account'));
                    setTimeout(() => {
                        window.location.href = '/index.html';
                    }, 1500);
                } else {
                    showToast(`登录失败：${message}`, false);
                }
            } catch (error) {
                console.error('登录请求失败：', error);
                const errorMsg = error.response?.data?.message || '登录失败，请检查账号密码或网络连接';
                showToast(errorMsg, false);
            }
        });

        // 8. 注册表单提交逻辑
        registerFormEl.addEventListener('submit', async function(e) {
            e.preventDefault();

            // 获取表单值
            const username = document.getElementById('register-username').value.trim();
            const phone = document.getElementById('register-phone').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;
            const agreeTerms = document.getElementById('agree-terms').checked;

            // 前端验证
            let isFormValid = true;

            if (!validateInput(document.getElementById('register-username'))) isFormValid = false;
            if (!validateInput(document.getElementById('register-phone'))) isFormValid = false;
            if (!validateInput(document.getElementById('register-email'))) isFormValid = false;
            if (!validateInput(document.getElementById('register-password'))) isFormValid = false;
            if (!validateInput(document.getElementById('register-confirm'))) isFormValid = false;

            // 验证1：手机号和邮箱不能同时为空
            if (!phone && !email) {
                showToast('手机号和邮箱至少填写一个', false);
                isFormValid = false;
            }

            // 验证5：协议勾选
            if (!agreeTerms) {
                showToast('请同意用户协议和隐私政策', false);
                isFormValid = false;
            }

            if (!isFormValid) {
                return;
            }

            // 收集表单数据
            const registerData = {
                username: username,
                phone: phone,
                email: email,
                password: password,
                confirmPassword: confirmPassword
            };

            try {
                const response = await axios({
                    url: `${BASE_URL}/user/register`,
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: registerData
                });

                const { code, message, data } = response.data;
                if (code === 200) {
                    showToast('注册成功！即将跳转到首页');
                    // 存储JWT令牌和用户信息
                    localStorage.setItem('authentication', data.token);
                    localStorage.setItem('userId', data.id);
                    localStorage.setItem('username', registerData.username);
                    // 注册成功后直接跳转到首页
                    setTimeout(() => {
                        window.location.href = '/index.html';
                    }, 1500);
                } else {
                    showToast(`注册失败：${message}`, false);
                }
            } catch (error) {
                console.error('注册请求失败：', error);
                const errorMsg = error.response?.data?.message || '注册失败，请检查信息或网络连接';
                showToast(errorMsg, false);
            }
        });
    });
</script>
</body>
</html>