<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>HipHop Ghetto | 发现</title>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@700;800&family=Montserrat:wght@400;500;600&display=swap');

        * {
            transition: all 0.3s ease;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: #0A0A0A;
            color: #CCCCCC;
            overflow-x: hidden;
            padding-bottom: 80px; /* 为底部播放器留出空间 */
        }

        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .nav-border {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .tab-active {
            border-bottom: 2px solid #FFD700;
            color: #FFFFFF !important;
        }

        .card-bg {
            background: #1F1F1F;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .hover-float:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.5);
        }

        .main-btn {
            background: linear-gradient(to right, #FFD700, #FFA500);
            border-radius: 8px;
            height: 48px;
            color: #0A0A0A;
            font-weight: 600;
        }

        .outline-btn {
            border: 1px solid #FFD700;
            border-radius: 8px;
            color: #FFD700;
        }

        .hot-tag {
            background: rgba(220, 20, 60, 0.3);
            border-radius: 4px;
            padding: 3px 8px;
            color: #FFCCCB;
        }

        .gold-tag {
            background: rgba(255, 215, 0, 0.2);
            border-radius: 4px;
            padding: 3px 8px;
            color: #FFD700;
        }

        .artist-name {
            font-style: italic;
            position: relative;
            display: inline-block;
        }

        .post-highlight {
            border-left: 4px solid #FFD700;
        }

        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(31,31,31,0.95);
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .section-title {
            background: linear-gradient(to right, #FFD700, #FF8C00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 专辑和歌曲网格样式 */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 24px;
        }

        .content-card:hover .play-button {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .content-card:hover img {
            transform: scale(1.05);
            filter: brightness(0.7);
        }

        .content-cover {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }

        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0A0A0A;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2;
        }

        /* 分页样式 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 40px;
            gap: 8px;
        }

        .pagination-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1F1F1F;
            color: #CCCCCC;
            border: none;
            cursor: pointer;
        }

        .pagination-btn:hover {
            background: #333;
            color: #FFD700;
        }

        .pagination-btn.active {
            background: #FFD700;
            color: #0A0A0A;
            font-weight: bold;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* 二级导航样式 */
        .secondary-nav {
            background: #121212;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .secondary-nav ul {
            display: flex;
            padding: 0;
            margin: 0;
            list-style: none;
        }

        .secondary-nav li {
            margin-right: 30px;
        }

        .secondary-nav a {
            display: block;
            padding: 16px 0;
            color: #CCCCCC;
            text-decoration: none;
            font-weight: 500;
            position: relative;
        }

        .secondary-nav a:hover {
            color: #FFFFFF;
        }

        .secondary-nav a.active {
            color: #FFD700;
        }

        .secondary-nav a.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: #FFD700;
        }

        /* 可点击元素样式 */
        .clickable {
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .clickable:hover {
            color: #FFD700 !important;
            text-decoration: underline;
        }

        /* 评分样式 */
        .rating-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: #FFD700;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1;
        }

        /* 专辑评分详情样式 */
        .rating-section {
            margin: 20px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }

        .rating-overview {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .rating-score {
            font-size: 48px;
            font-weight: bold;
            color: #FFD700;
            margin-right: 20px;
        }

        .rating-stats {
            flex: 1;
        }

        .rating-bar-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .rating-star {
            width: 40px;
            text-align: right;
            margin-right: 10px;
            color: #FFD700;
        }

        .rating-bar {
            flex: 1;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            background: linear-gradient(to right, #FFD700, #FFA500);
        }

        .rating-count {
            width: 50px;
            text-align: left;
            margin-left: 10px;
            font-size: 14px;
            color: #888;
        }

        /* 评分表单样式 */
        .rating-form {
            margin-top: 30px;
        }

        .rating-form h4 {
            font-size: 18px;
            margin-bottom: 15px;
            color: white;
        }

        .star-rating {
            display: flex;
            margin-bottom: 15px;
        }

        .star {
            font-size: 32px;
            color: #444;
            cursor: pointer;
            margin-right: 10px;
            transition: color 0.2s;
        }

        .star:hover, .star.selected {
            color: #FFD700;
        }

        .rating-submit {
            background: linear-gradient(to right, #FFD700, #FFA500);
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            font-weight: 600;
            color: #0A0A0A;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .rating-submit:hover {
            transform: scale(1.05);
        }

        .rating-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .rating-success {
            background: rgba(72, 187, 120, 0.2);
            color: #48BB78;
            display: block;
        }

        .rating-error {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
            display: block;
        }

        /* 折叠功能样式 */
        .collapse-trigger {
            background: rgba(255, 215, 0, 0.1);
            padding: 8px 0;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .collapse-trigger:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .collapse-content.hidden {
            max-height: 0;
            overflow: hidden;
        }

        .collapse-content {
            max-height: 1000px;
            overflow: visible;
        }

        .rotate-180 {
            transform: rotate(180deg);
        }

        @media (max-width: 1024px) {
            .container {
                padding: 0 20px;
            }

            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 16px;
            }

            .secondary-nav li {
                margin-right: 20px;
            }
        }
    </style>
</head>
<body>
<!-- 顶部导航 -->
<header class="nav-border bg-black py-4 sticky top-0 z-50">
    <div class="container flex items-center justify-between">
        <!-- Logo -->
        <div class="flex items-center">
            <iconify-icon class="text-gold" height="38" icon="game-icons:boom-mic" width="40"></iconify-icon>
            <h1 class="text-white text-2xl font-bold ml-2 tracking-wider">HipHop Ghetto</h1>
        </div>
        <!-- 主导航 -->
        <nav>
            <ul class="flex space-x-8">
                <li><a class="text-[#CCCCCC] hover:text-white text-base font-medium" href="index.html">主页</a></li>
                <li><a class="text-[#CCCCCC] hover:text-white text-base font-medium" href="#">推荐</a></li>
                <li><a class="text-white text-base font-medium tab-active" href="#">发现</a></li>
                <li><a class="text-[#CCCCCC] hover:text-white text-base font-medium" href="#">讨论区</a></li>
                <li><a class="text-[#CCCCCC] hover:text-white text-base font-medium" href="#">我的</a></li>
            </ul>
        </nav>
        <!-- 右侧功能 -->
        <div class="flex items-center space-x-5">
            <div class="relative">
                <input class="bg-[#1F1F1F] border border-[#333] rounded-lg py-2 px-4 w-64 focus:border-[#FFD700] focus:outline-none" placeholder="搜索专辑、歌曲..." type="text"/>
                <iconify-icon class="text-[#808080] absolute right-3 top-2.5" icon="akar-icons:search"></iconify-icon>
            </div>
            <iconify-icon class="text-[#CCCCCC] hover:text-white cursor-pointer" icon="mdi:bell-outline" width="24"></iconify-icon>
            <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-[#FFD700] cursor-pointer">
                <img alt="User avatar" class="w-full h-full object-cover" src="/agent-py/workspace/68f378a250f4deb5b97ceb4c/generated_images/b706d8b320fa453ab34ba7f3fdf0e64c.jpg"/>
            </div>
        </div>
    </div>
</header>

<!-- 二级导航栏 -->
<div class="secondary-nav">
    <div class="container">
        <ul>
            <li><a href="#" class="active" data-type="album">专辑</a></li>
            <li><a href="#" data-type="song">歌曲</a></li>
            <li><a href="#" data-type="artist">歌手</a></li>
        </ul>
    </div>
</div>

<!-- 主内容区 -->
<main>
    <!-- 内容展示区 -->
    <section class="py-8">
        <div class="container">

            <!-- 加载状态 -->
            <div id="loading" class="flex justify-center items-center py-16">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#FFD700]"></div>
            </div>

            <!-- 错误状态 -->
            <div id="error" class="hidden text-center py-16">
                <p class="text-[#FF6B6B]">加载内容失败，请稍后重试</p>
                <button id="retryBtn" class="mt-4 px-6 py-2 main-btn">重试</button>
            </div>

            <!-- 专辑网格 -->
            <div id="albumContainer" class="content-grid hidden">
                <!-- 专辑卡片将通过JavaScript动态生成 -->
            </div>

            <!-- 歌曲网格 -->
            <div id="songContainer" class="content-grid hidden">
                <!-- 歌曲卡片将通过JavaScript动态生成 -->
            </div>

            <!-- 分页控件 -->
            <div id="pagination" class="pagination hidden">
                <button id="prevPage" class="pagination-btn" disabled>
                    <iconify-icon icon="mdi:chevron-left" width="16"></iconify-icon>
                </button>
                <div id="pageNumbers">
                    <!-- 页码将通过JavaScript动态生成 -->
                </div>
                <button id="nextPage" class="pagination-btn">
                    <iconify-icon icon="mdi:chevron-right" width="16"></iconify-icon>
                </button>
            </div>
        </div>
    </section>

    <!-- 专辑详情区域 -->
    <div id="albumDetail" class="hidden py-8">
        <div class="container card-bg p-8">
            <button id="backToAlbums" class="outline-btn px-4 py-2 mb-6">返回专辑列表</button>
            <div class="flex flex-col md:flex-row gap-8">
                <div class="content-cover md:w-1/3">
                    <img id="detailAlbumCover" alt="Album cover" class="w-full rounded">
                </div>
                <div class="md:w-2/3">
                    <h3 id="detailAlbumName" class="text-3xl font-bold text-white mb-2"></h3>
                    <p class="text-[#FFD700] mb-4"><span class="artist-name" id="detailAlbumSinger"></span> · <span id="detailReleaseTime"></span></p>
                    <p id="detailIntroduction" class="text-gray-300 mb-6"></p>

                    <!-- 专辑评分区域 -->
                    <div class="rating-section">
                        <h4 class="text-xl font-bold text-white mb-4">专辑评分</h4>
                        <div class="rating-overview">
                            <div class="rating-score" id="albumTotalScore">0.0</div>
                            <div class="rating-stats">
                                <p class="text-gray-300" id="ratingCount">0 人评分</p>
                                <div class="flex mt-2">
                                    <iconify-icon icon="mdi:star" width="20" class="text-[#FFD700]"></iconify-icon>
                                    <iconify-icon icon="mdi:star" width="20" class="text-[#FFD700]"></iconify-icon>
                                    <iconify-icon icon="mdi:star" width="20" class="text-[#FFD700]"></iconify-icon>
                                    <iconify-icon icon="mdi:star" width="20" class="text-[#FFD700]"></iconify-icon>
                                    <iconify-icon icon="mdi:star-half" width="20" class="text-[#FFD700]"></iconify-icon>
                                </div>
                            </div>
                        </div>

                        <!-- 折叠触发按钮 -->
                        <div class="collapse-trigger flex items-center justify-center mt-4 mb-2 cursor-pointer" id="collapseTrigger">
                            <span class="text-gray-300 mr-2">查看评分详情</span>
                            <iconify-icon icon="mdi:chevron-down" width="20" class="text-[#FFD700] transition-transform duration-300" id="collapseArrow"></iconify-icon>
                        </div>

                        <!-- 折叠内容容器（默认隐藏） -->
                        <div class="collapse-content hidden transition-all duration-300 ease-in-out" id="collapseContent">
                            <!-- 评分分布 -->
                            <div id="ratingDistribution">
                                <!-- 将通过JS动态生成 -->
                            </div>

                            <!-- 评分表单 -->
                            <div class="rating-form mt-8">
                                <h4>给这张专辑评分</h4>
                                <div class="star-rating" id="starRating">
                                    <span class="star" data-value="1"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="2"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="3"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="4"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="5"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="6"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="7"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="8"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="9"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                    <span class="star" data-value="10"><iconify-icon icon="mdi:star" width="32"></iconify-icon></span>
                                </div>
                                <button id="submitRating" class="rating-submit">提交评分</button>
                                <div id="ratingMessage" class="rating-message"></div>
                            </div>
                        </div>
                    </div>

                    <h4 class="text-xl font-bold text-white mb-4">歌曲列表</h4>
                    <div id="songList" class="space-y-3">
                        <!-- 歌曲列表将动态生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 歌曲详情区域 -->
    <div id="songDetail" class="hidden py-8">
        <div class="container card-bg p-8">
            <button id="backToSongs" class="outline-btn px-4 py-2 mb-6">返回歌曲列表</button>
            <div class="flex flex-col md:flex-row gap-8">
                <div class="content-cover md:w-1/3">
                    <img id="detailSongCover" alt="Song cover" class="w-full rounded">
                </div>
                <div class="md:w-2/3">
                    <h3 id="detailSongName" class="text-3xl font-bold text-white mb-2"></h3>
                    <p class="text-[#FFD700] mb-4"><span class="artist-name" id="detailSongSinger"></span></p>
                    <p class="text-gray-300 mb-2">专辑: <span id="detailAlbumFrom" class="clickable"></span></p>
                    <p class="text-gray-300 mb-6">时长: <span id="detailSongDuration"></span></p>
                    <button class="main-btn px-8 py-3 text-lg">立即播放</button>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 底部区域 -->
<footer class="py-16 bg-[#0A0A0A] border-t border-[#1F1F1F]">
    <div class="container">
        <div class="grid grid-cols-4 gap-8">
            <div>
                <div class="flex items-center mb-4">
                    <iconify-icon class="text-gold" icon="game-icons:boom-mic" width="32"></iconify-icon>
                    <h3 class="text-white text-xl font-bold ml-2">RHYME STREET</h3>
                </div>
                <p class="text-sm text-[#808080] mb-4 pr-8">最专业的说唱音乐爱好者交流平台，发现街头音乐的魅力。</p>
                <div class="flex space-x-4">
                    <a class="text-[#CCCCCC] hover:text-[#FFD700]" href="#">
                        <iconify-icon icon="mdi:twitter" width="24"></iconify-icon>
                    </a>
                    <a class="text-[#CCCCCC] hover:text-[#FFD700]" href="#">
                        <iconify-icon icon="mdi:instagram" width="24"></iconify-icon>
                    </a>
                    <a class="text-[#CCCCCC] hover:text-[#FFD700]" href="#">
                        <iconify-icon icon="mdi:youtube" width="24"></iconify-icon>
                    </a>
                </div>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4">平台栏目</h4>
                <ul class="space-y-2">
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">音乐推荐</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">专辑评分</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">歌词大全</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">赛事活动</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4">帮助中心</h4>
                <ul class="space-y-2">
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">用户指南</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">版权说明</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">问题反馈</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">联系我们</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4">友情链接</h4>
                <ul class="space-y-2">
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">Beat交易平台</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">音乐制作社区</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">嘻哈文化杂志</a></li>
                    <li><a class="text-[#CCCCCC] hover:text-[#FFD700] text-sm" href="#">街头服饰品牌</a></li>
                </ul>
            </div>
        </div>
        <div class="mt-16 pt-8 text-center text-sm text-[#808080] border-t border-[#1F1F1F]">
            © 2023 RHYME STREET 说唱音乐平台 · 用户协议 · 隐私政策
        </div>
    </div>
</footer>

<!-- 音乐播放器 -->
<div class="player">
    <div class="container">
        <div class="flex items-center justify-between py-3">
            <div class="flex items-center">
                <div class="w-14 h-14 rounded mr-3 overflow-hidden">
                    <img alt="Current playing track album cover" class="w-full h-full object-cover" src="/agent-py/workspace/68f378a250f4deb5b97ceb4c/generated_images/6b7ea6f1dd4e4f579c47a8c47e494b33.jpg"/>
                </div>
                <div>
                    <h4 class="text-white font-medium">BEAT THE STREET</h4>
                    <p class="text-xs text-[#808080]"><span class="artist-name">Q-BOOM</span> · NEW TRACK</p>
                </div>
            </div>
            <div class="flex-1 max-w-lg">
                <div class="flex items-center justify-center mb-2">
                    <button class="text-[#CCCCCC] hover:text-[#FFD700] mx-2">
                        <iconify-icon icon="mdi:skip-previous" width="30"></iconify-icon>
                    </button>
                    <button class="ml-4 w-12 h-12 rounded-full flex items-center justify-center main-btn hover:scale-105 mx-2">
                        <iconify-icon icon="mdi:play" width="24"></iconify-icon>
                    </button>
                    <button class="text-[#CCCCCC] hover:text-[#FFD700] mx-2">
                        <iconify-icon icon="mdi:skip-next" width="30"></iconify-icon>
                    </button>
                </div>
                <div class="flex items-center">
                    <span class="text-xs text-[#808080]">1:34</span>
                    <div class="flex-1 bg-[#333] h-1 rounded-full overflow-hidden mx-2">
                        <div class="bg-[#FFD700] h-full" style="width: 30%"></div>
                    </div>
                    <span class="text-xs text-[#808080]">4:12</span>
                </div>
            </div>
            <div class="flex items-center">
                <iconify-icon class="text-[#CCCCCC] hover:text-[#FFD700] mr-5 cursor-pointer" icon="mdi:playlist-music" width="24"></iconify-icon>
                <iconify-icon class="text-[#CCCCCC] hover:text-[#FFD700] cursor-pointer" icon="mdi:volume-high" width="24"></iconify-icon>
            </div>
        </div>
    </div>
</div>

<script>
    // 全局变量
    const API_BASE_URL = 'http://localhost:9998';
    let currentPage = 1;
    const pageSize = 12; // 每页显示12条
    let totalPages = 1; // 动态更新总页数
    let hasMoreData = true; // 标记是否有下一页
    let currentContentType = 'album'; // 当前显示的内容类型：album/song/artist
    let currentAlbumId = null; // 当前查看的专辑ID
    let selectedRating = null; // 用户选择的评分

    // DOM元素
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const pagination = document.getElementById('pagination');
    const pageNumbers = document.getElementById('pageNumbers');
    const prevPageBtn = document.getElementById('prevPage');
    const nextPageBtn = document.getElementById('nextPage');
    const retryBtn = document.getElementById('retryBtn');

    // 内容容器
    const albumContainer = document.getElementById('albumContainer');
    const songContainer = document.getElementById('songContainer');

    // 详情容器
    const albumDetail = document.getElementById('albumDetail');
    const songDetail = document.getElementById('songDetail');

    // 返回按钮
    const backToAlbumsBtn = document.getElementById('backToAlbums');
    const backToSongsBtn = document.getElementById('backToSongs');

    // 专辑和歌曲详情中的交互元素
    const detailAlbumFrom = document.getElementById('detailAlbumFrom');
    const songListContainer = document.getElementById('songList');

    // 评分相关元素
    const ratingDistribution = document.getElementById('ratingDistribution');
    const albumTotalScore = document.getElementById('albumTotalScore');
    const ratingCount = document.getElementById('ratingCount');
    const starRating = document.getElementById('starRating');
    const submitRatingBtn = document.getElementById('submitRating');
    const ratingMessage = document.getElementById('ratingMessage');

    // 折叠功能相关元素
    const collapseTrigger = document.getElementById('collapseTrigger');
    const collapseArrow = document.getElementById('collapseArrow');
    const collapseContent = document.getElementById('collapseContent');
    const collapseText = collapseTrigger.querySelector('span');

    // 初始化页面
    document.addEventListener('DOMContentLoaded', () => {
        // 加载初始内容（专辑）
        fetchContent(currentContentType, currentPage);

        // 分页按钮事件监听
        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                fetchContent(currentContentType, currentPage);
            }
        });

        nextPageBtn.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                fetchContent(currentContentType, currentPage);
            }
        });

        // 重试按钮事件
        retryBtn.addEventListener('click', () => {
            fetchContent(currentContentType, currentPage);
        });

        // 返回按钮事件
        backToAlbumsBtn.addEventListener('click', () => {
            albumDetail.classList.add('hidden');
            showContent('album');
        });

        backToSongsBtn.addEventListener('click', () => {
            songDetail.classList.add('hidden');
            showContent('song');
        });

        // 二级导航切换效果
        document.querySelectorAll('.secondary-nav a').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();

                // 获取内容类型
                const contentType = this.getAttribute('data-type');
                if (contentType === currentContentType) return;

                // 更新当前内容类型
                currentContentType = contentType;
                currentPage = 1; // 重置页码

                // 移除所有active类
                document.querySelectorAll('.secondary-nav a').forEach(link => {
                    link.classList.remove('active');
                });

                // 为当前点击的添加active类
                this.classList.add('active');

                // 加载对应内容
                fetchContent(currentContentType, currentPage);
            });
        });

        // 歌曲详情中的专辑点击事件
        detailAlbumFrom.addEventListener('click', function() {
            const albumId = this.getAttribute('data-album-id');
            if (albumId) {
                fetchAlbumDetail(albumId);
            }
        });

        // 专辑详情中的歌曲点击事件委托
        songListContainer.addEventListener('click', function(e) {
            const songItem = e.target.closest('.song-item');
            if (songItem) {
                const songId = songItem.getAttribute('data-song-id');
                if (songId) {
                    fetchSongDetail(songId);
                }
            }
        });

        // 星级评分选择事件
        starRating.addEventListener('click', function(e) {
            const star = e.target.closest('.star');
            if (star) {
                selectedRating = parseInt(star.getAttribute('data-value'));
                updateStarSelection();
            }
        });

        // 提交评分事件
        submitRatingBtn.addEventListener('click', function() {
            if (selectedRating && currentAlbumId) {
                submitAlbumRating(currentAlbumId, selectedRating);
            } else {
                showRatingMessage('请先选择评分', 'error');
            }
        });

        // 折叠/展开切换事件
        collapseTrigger.addEventListener('click', () => {
            // 切换内容显示状态
            collapseContent.classList.toggle('hidden');
            // 切换箭头旋转
            collapseArrow.classList.toggle('rotate-180');
            // 切换文本提示
            collapseText.textContent = collapseContent.classList.contains('hidden')
                ? '查看评分详情'
                : '收起评分详情';
        });

        // 添加卡片悬停效果
        addCardHoverEffects();
    });

    /**
     * 根据内容类型获取数据
     * @param {string} type 内容类型：album/song
     * @param {number} page 页码
     */
    async function fetchContent(type, page) {
        // 显示加载状态
        showLoading();

        try {
            const requestSize = pageSize + 1;
            let response, result;

            if (type === 'album') {
                // 获取专辑数据
                response = await fetch(`${API_BASE_URL}/albums`, {
                    method: 'POST',
                    headers: {
                        'accept': '*/*',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        page: page,
                        size: requestSize
                    })
                });
            } else if (type === 'song') {
                // 获取歌曲数据
                response = await fetch(`${API_BASE_URL}/songs`, {
                    method: 'POST',
                    headers: {
                        'accept': '*/*',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        page: page,
                        size: requestSize
                    })
                });
            }

            result = await response.json();

            if (result.code !== 200 || !result.data || !Array.isArray(result.data.list)) {
                throw new Error('数据格式错误');
            }

            const fetchedList = result.data.list;
            const currentPageList = fetchedList.slice(0, pageSize);

            hasMoreData = fetchedList.length > pageSize;
            totalPages = hasMoreData ? page + 1 : page;

            // 渲染当前页数据和分页
            if (type === 'album') {
                renderAlbums(currentPageList);
            } else if (type === 'song') {
                renderSongs(currentPageList);
            }

            updatePagination();
            showContent(type);

        } catch (err) {
            console.error(`Error fetching ${type}s:`, err);
            showError();
        }
    }

    /**
     * 获取专辑详情
     * @param {number} albumId 专辑ID
     */
    async function fetchAlbumDetail(albumId) {
        showLoading();
        try {
            // 保存当前专辑ID
            currentAlbumId = albumId;

            // 获取专辑基本信息
            const response = await fetch(`${API_BASE_URL}/album/${albumId}`, {
                method: 'GET',
                headers: { 'accept': '*/*' }
            });
            const result = await response.json();
            if (result.code !== 200 || !result.data) {
                throw new Error('获取专辑详情失败');
            }

            // 渲染专辑基本信息
            renderAlbumDetail(result.data);

            // 获取并渲染评分详情
            await fetchAndRenderAlbumScore(albumId);

        } catch (err) {
            console.error('Error fetching album detail:', err);
            showError();
        } finally {
            loading.classList.add('hidden');
        }
    }

    /**
     * 获取并渲染专辑评分详情
     * @param {number} albumId 专辑ID
     */
    async function fetchAndRenderAlbumScore(albumId) {
        try {
            const response = await fetch(`${API_BASE_URL}/album/score/${albumId}`, {
                method: 'GET',
                headers: { 'accept': '*/*' }
            });
            const result = await response.json();

            if (result.code === 200 && result.data) {
                renderAlbumScore(result.data);
            } else {
                throw new Error('获取专辑评分失败');
            }
        } catch (err) {
            console.error('Error fetching album score:', err);
            // 可以在这里设置默认评分或显示错误信息
            ratingDistribution.innerHTML = '<p class="text-gray-400">无法加载评分数据</p>';
        }
    }

    /**
     * 提交专辑评分
     * @param {number} albumId 专辑ID
     * @param {number} score 评分（1-10）
     */
    async function submitAlbumRating(albumId, score) {
        try {
            // 从localStorage中获取userId，而不是硬编码
            const userId = localStorage.getItem('userId');

            // 检查用户是否已登录
            if (!userId) {
                showRatingMessage('请先登录后再进行评分', 'error');
                return; // 阻止继续执行评分提交
            }

            const response = await fetch(`${API_BASE_URL}/album/score`, {
                method: 'POST',
                headers: {
                    'accept': '*/*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userId: userId,
                    albumId: albumId,
                    score: score
                })
            });

            const result = await response.json();

            if (result.code === 200) {
                showRatingMessage('评分提交成功！', 'success');
                // 重新获取并更新评分显示
                await fetchAndRenderAlbumScore(albumId);
            } else {
                showRatingMessage('评分提交失败，请稍后重试', 'error');
            }
        } catch (err) {
            console.error('Error submitting album rating:', err);
            showRatingMessage('网络错误，请稍后重试', 'error');
        }
    }

    /**
     * 渲染专辑评分详情
     * @param {Object} scoreData 评分数据
     */
    function renderAlbumScore(scoreData) {
        // 更新总分和评分人数
        albumTotalScore.textContent = scoreData.score.toFixed(1);
        ratingCount.textContent = `${scoreData.total} 人评分`;

        // 清空现有评分分布
        ratingDistribution.innerHTML = '';

        const numberWords = ['one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten'];

        // 评分从高到低显示（10-1分）
        for (let i = 10; i >= 1; i--) {
            const count = scoreData[numberWords[i-1]] || 0;
            const percentage = scoreData.total > 0 ? (count / scoreData.total) * 100 : 0;

            const barContainer = document.createElement('div');
            barContainer.className = 'rating-bar-container';

            barContainer.innerHTML = `
                <div class="rating-star">${i}分</div>
                <div class="rating-bar">
                    <div class="rating-fill" style="width: ${percentage}%"></div>
                </div>
                <div class="rating-count">${count}</div>
            `;

            ratingDistribution.appendChild(barContainer);
        }
    }

    /**
     * 获取歌曲详情
     * @param {number} songId 歌曲ID
     */
    async function fetchSongDetail(songId) {
        showLoading();
        try {
            const response = await fetch(`${API_BASE_URL}/song/${songId}`, {
                method: 'GET',
                headers: { 'accept': '*/*' }
            });
            const result = await response.json();
            if (result.code !== 200 || !result.data) {
                throw new Error('获取歌曲详情失败');
            }
            renderSongDetail(result.data);
        } catch (err) {
            console.error('Error fetching song detail:', err);
            showError();
        } finally {
            loading.classList.add('hidden');
        }
    }

    /**
     * 渲染专辑列表
     * @param {Array} albums 专辑数组
     */
    function renderAlbums(albums) {
        // 清空容器
        albumContainer.innerHTML = '';

        if (albums.length === 0) {
            albumContainer.innerHTML = '<div class="col-span-full text-center py-16">没有找到专辑</div>';
            return;
        }

        // 生成专辑卡片
        albums.forEach(async album => {
            const albumCard = document.createElement('div');
            albumCard.className = 'content-card hover-float';

            // 创建基础卡片结构
            albumCard.innerHTML = `
            <div class="content-cover mb-4">
                <img alt="Album cover: ${album.name}" class="w-full aspect-square object-cover transition-transform duration-500" src="${album.url}"/>
                <div class="play-button">
                    <iconify-icon icon="mdi:play" width="24"></iconify-icon>
                </div>
                <!-- 评分将在这里动态插入 -->
            </div>
            <h4 class="text-white font-bold truncate" title="${album.name}">${album.name}</h4>
            <p class="text-sm text-[#808080] mt-1"><span class="artist-name">${album.singer}</span></p>
        `;

            // 点击专辑卡片，请求详情
            albumCard.addEventListener('click', () => {
                fetchAlbumDetail(album.id);
            });

            albumContainer.appendChild(albumCard);

            // 获取并显示评分
            const contentCover = albumCard.querySelector('.content-cover');
            const ratingBadge = document.createElement('div');
            ratingBadge.className = 'rating-badge';

            const score = await fetchAlbumScore(album.id);
            ratingBadge.textContent = score !== null ? `${score.toFixed(1)}分` : '暂无评分';

            contentCover.appendChild(ratingBadge);
        });
    }

    /**
     * 获取专辑评分（用于列表展示）
     * @param {number} albumId 专辑ID
     */
    async function fetchAlbumScore(albumId) {
        try {
            const response = await fetch(`${API_BASE_URL}/album/score/${albumId}`, {
                method: 'GET',
                headers: { 'accept': '*/*' }
            });
            const result = await response.json();
            if (result.code === 200 && result.data) {
                return result.data.score;
            }
            return null;
        } catch (err) {
            console.error('Error fetching album score:', err);
            return null;
        }
    }

    /**
     * 渲染歌曲列表
     * @param {Array} songs 歌曲数组
     */
    function renderSongs(songs) {
        // 清空容器
        songContainer.innerHTML = '';

        if (songs.length === 0) {
            songContainer.innerHTML = '<div class="col-span-full text-center py-16">没有找到歌曲</div>';
            return;
        }

        // 生成歌曲卡片
        songs.forEach(song => {
            const songCard = document.createElement('div');
            songCard.className = 'content-card hover-float';
            songCard.innerHTML = `
                <div class="content-cover mb-4">
                    <img alt="Song cover: ${song.name}" class="w-full aspect-square object-cover transition-transform duration-500" src="${song.url}"/>
                    <div class="play-button">
                        <iconify-icon icon="mdi:play" width="24"></iconify-icon>
                    </div>
                </div>
                <h4 class="text-white font-bold truncate" title="${song.name}">${song.name}</h4>
                <p class="text-sm text-[#808080] mt-1"><span class="artist-name">${song.singer}</span></p>
                <p class="text-xs text-gray-500 mt-1 clickable" data-album-id="${song.albumId}">${song.albumName}</p>
            `;
            // 点击歌曲卡片，请求详情
            songCard.addEventListener('click', () => {
                fetchSongDetail(song.id);
            });
            songContainer.appendChild(songCard);
        });
    }

    /**
     * 渲染专辑详情
     * @param {Object} albumData 专辑数据
     */
    function renderAlbumDetail(albumData) {
        // 隐藏列表和分页
        hideAllContent();

        // 重置评分选择
        selectedRating = null;
        updateStarSelection();
        ratingMessage.className = 'rating-message';

        // 填充专辑基本信息
        document.getElementById('detailAlbumCover').src = albumData.url;
        document.getElementById('detailAlbumName').textContent = albumData.name;
        document.getElementById('detailAlbumSinger').textContent = albumData.singer;
        document.getElementById('detailReleaseTime').textContent = albumData.releaseTime;
        document.getElementById('detailIntroduction').textContent = albumData.introduction;

        // 填充歌曲列表
        songListContainer.innerHTML = '';
        albumData.songs.forEach((song, index) => {
            const songItem = document.createElement('div');
            songItem.className = 'song-item flex items-center justify-between p-3 bg-[#2a2a2a] rounded hover:bg-[#333333]';
            songItem.setAttribute('data-song-id', song.id);
            songItem.innerHTML = `
            <div class="flex items-center">
                <span class="text-gray-500 mr-4 w-6 text-center">${index + 1}</span>
                <div>
                    <p class="text-white font-medium">${song.name}</p>
                    <p class="text-sm text-gray-400">${song.singer}</p>
                </div>
            </div>
            <p class="text-gray-400">${formatDuration(song.duration)}</p>
        `;
            songListContainer.appendChild(songItem);
        });

        // 显示专辑详情
        albumDetail.classList.remove('hidden');
    }

    /**
     * 渲染歌曲详情
     * @param {Object} songData 歌曲数据
     */
    function renderSongDetail(songData) {
        // 隐藏列表和分页
        hideAllContent();

        // 填充歌曲基本信息
        document.getElementById('detailSongCover').src = songData.url;
        document.getElementById('detailSongName').textContent = songData.name;
        document.getElementById('detailSongSinger').textContent = songData.singer;
        document.getElementById('detailAlbumFrom').textContent = songData.albumName;
        document.getElementById('detailAlbumFrom').setAttribute('data-album-id', songData.albumId);
        document.getElementById('detailSongDuration').textContent = formatDuration(songData.duration);

        // 显示歌曲详情
        songDetail.classList.remove('hidden');
    }

    /**
     * 辅助函数：将秒数转换为“分:秒”格式
     * @param {number} seconds 秒数
     * @returns {string} 格式化后的时间字符串
     */
    function formatDuration(seconds) {
        const min = Math.floor(seconds / 60);
        const sec = seconds % 60;
        return `${min}:${sec < 10 ? '0' + sec : sec}`;
    }

    /**
     * 更新分页控件
     */
    function updatePagination() {
        pageNumbers.innerHTML = '';

        // 创建当前页码按钮
        const currentPageBtn = document.createElement('button');
        currentPageBtn.className = 'pagination-btn active';
        currentPageBtn.textContent = currentPage;
        pageNumbers.appendChild(currentPageBtn);

        // 更新上一页/下一页按钮状态
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = !hasMoreData;
    }

    /**
     * 显示加载状态
     */
    function showLoading() {
        loading.classList.remove('hidden');
        hideAllContent();
        error.classList.add('hidden');
        pagination.classList.add('hidden');
    }

    /**
     * 显示指定类型的内容
     * @param {string} type 内容类型：album/song
     */
    function showContent(type) {
        loading.classList.add('hidden');
        error.classList.add('hidden');
        pagination.classList.remove('hidden');

        // 隐藏所有内容容器
        hideAllContent();

        // 显示当前类型的内容容器
        if (type === 'album') {
            albumContainer.classList.remove('hidden');
        } else if (type === 'song') {
            songContainer.classList.remove('hidden');
        }
    }

    /**
     * 隐藏所有内容容器
     */
    function hideAllContent() {
        albumContainer.classList.add('hidden');
        songContainer.classList.add('hidden');
        albumDetail.classList.add('hidden');
        songDetail.classList.add('hidden');
    }

    /**
     * 显示错误状态
     */
    function showError() {
        loading.classList.add('hidden');
        hideAllContent();
        pagination.classList.add('hidden');
        error.classList.remove('hidden');
    }

    /**
     * 更新星级选择状态
     */
    function updateStarSelection() {
        const stars = starRating.querySelectorAll('.star');
        stars.forEach(star => {
            const value = parseInt(star.getAttribute('data-value'));
            if (selectedRating !== null && value <= selectedRating) {
                star.classList.add('selected');
            } else {
                star.classList.remove('selected');
            }
        });
    }

    /**
     * 显示评分操作消息
     * @param {string} message 消息内容
     * @param {string} type 消息类型：success/error
     */
    function showRatingMessage(message, type) {
        ratingMessage.textContent = message;
        ratingMessage.className = 'rating-message';
        ratingMessage.classList.add(`rating-${type}`);

        // 3秒后自动隐藏消息
        setTimeout(() => {
            ratingMessage.className = 'rating-message';
        }, 3000);
    }

    /**
     * 添加卡片悬停效果
     */
    function addCardHoverEffects() {
        const cards = document.querySelectorAll('.hover-float');
        cards.forEach(card => {
            card.addEventListener('mousemove', function(e) {
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                this.style.transform = `translateY(${-5 + (y / rect.height - 0.5) * 2}px) rotateX(${(y / rect.height - 0.5) * 1}deg) rotateY(${(x / rect.width - 0.5) * 3}deg)`;
            });

            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) rotateX(0) rotateY(0)';
            });
        });
    }
</script>
</body>
</html>